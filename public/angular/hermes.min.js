(function(){angular.module("adminApp",["ngRoute","ui.bootstrap"]);function t(t,e){t.when("/",{templateUrl:"/admin/admin.view.html",controller:"adminCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("adminApp").config(["$routeProvider",t])})();(function(){angular.module("adminApp").service("adminData",t);t.$inject=["$http","authentication"];function t(t,e){var r=function(){return t.get("/api/shop/")};var n=function(r){return t.post("/api/shop/",r,{headers:{Authorization:"Bearer "+e.getToken()}})};var o=function(r,n,o){return t.put("/api/shop/"+r+"/"+n,o,{headers:{Authorization:"Bearer "+e.getToken()}})};var a=function(r,n){return t.delete("/api/shop/"+r+"/"+n,{headers:{Authorization:"Bearer "+e.getToken()}})};return{listproducts:r,addProduct:n,deleteProduct:a,updateProduct:o}}})();(function(){angular.module("adminApp").controller("adminCtrl",t);t.$inject=["adminData","$uibModal","authentication"];function t(t,e,r){var n=this;t.listproducts().success(function(t){n.data={products:t}}).error(function(t){console.log(t)});n.isLoggedIn=r.isLoggedIn();n.popupCreate=function(){var t=e.open({templateUrl:"createModal/createModal.view.html",controller:"createModalCtrl as vm"});t.result.then(function(t){n.data.products.push(t)})};n.popupUpdate=function(t){var r=e.open({templateUrl:"updateModal/updateModal.view.html",controller:"updateModalCtrl as vm",resolve:{productData:function(){return{product:t}}}});r.result.then(function(e){t.title=e.title;t.category=e.category;t.url=e.url;t.categoryurl=e.categoryurl;t.price=e.price;t.description=e.description;t.img=e.img;t.banner=e.banner})};n.popupDelete=function(t,r,n,o){var a=e.open({templateUrl:"deleteModal/deleteModal.view.html",controller:"deleteModalCtrl as vm",resolve:{productData:function(){return{url:t,categoryurl:r,title:n}}}});a.result.then(function(t){o.title=false})}}})();(function(){angular.module("adminApp").controller("createModalCtrl",t);t.$inject=["$uibModalInstance","adminData"];function t(t,e){var r=this;r.modal={cancel:function(){t.dismiss("cancel")},close:function(e){t.close(e)}};r.onSubmit=function(){r.formError="";if(!r.formData.title||!r.formData.category||!r.formData.price||!r.formData.img||!r.formData.description){r.formError="All fields required, please try again";return false}else{r.doAddProduct=function(t){e.addProduct({title:t.title,banner:t.banner,category:t.category,description:t.description,price:t.price,img:t.img}).success(function(t){r.modal.close(t)}).error(function(t){r.formError="Your product has not been saved, try agian"});return false};r.doAddProduct(r.formData)}}}})();(function(){angular.module("adminApp").controller("deleteModalCtrl",t);t.$inject=["$uibModalInstance","productData","adminData"];function t(t,e,r){var n=this;n.productData=e;n.modal={cancel:function(){t.dismiss("cancel")},close:function(e){t.close(e)}};n.onSubmit=function(){n.deleteProduct=function(t,e){r.deleteProduct(t,e).success(function(t){n.modal.close(t)}).error(function(t){console.log(t)});return false};n.deleteProduct(n.productData.categoryurl,n.productData.url)}}})();(function(){angular.module("adminApp").filter("formatPrice",t);function t(){return function(t){return String(t).replace(".",",")}}})();(function(){angular.module("adminApp").controller("updateModalCtrl",t);t.$inject=["$uibModalInstance","adminData","productData"];function t(t,e,r){vm=this;vm.productData=r.product;vm.productData.img=String(r.product.img).replace(",",", ");vm.modal={cancel:function(){t.dismiss("cancel")},close:function(e){t.close(e);console.log(e)}};vm.onSubmit=function(){vm.formError="";if(!vm.formData.title||!vm.formData.banner||!vm.formData.category||!vm.formData.price||!vm.formData.img||!vm.formData.description){vm.formError="All fields required, please try again";return false}else{vm.doUpdateProduct=function(t){e.updateProduct(vm.productData.categoryurl,vm.productData.url,{title:t.title,banner:t.banner,category:t.category,description:t.description,price:t.price,img:t.img}).success(function(t){vm.modal.close(t)}).error(function(t){vm.formError="Your product has not been saved, try agian"});return false};vm.doUpdateProduct(vm.formData)}}}})();(function(){angular.module("adminApp").service("authentication",t);t.$inject=["$window","$http"];function t(t,e){var r=function(e){t.localStorage["admin-token"]=e};var n=function(){return t.localStorage["admin-token"]};var o=function(t){return e.post("/api/register",t).success(function(t){r(t.token)})};var a=function(t){return e.post("/api/login",t).success(function(t){r(t.token)})};var i=function(){t.localStorage.removeItem("admin-token")};var l=function(){var e=n();if(e){var r=JSON.parse(t.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var c=function(){if(l()){var e=n();var r=JSON.parse(t.atob(e.split(".")[1]));return{email:r.email,name:r.name}}};return{saveToken:r,getToken:n,register:o,login:a,logout:i,isLoggedIn:l,currentUser:c}}})();(function(){angular.module("adminApp").controller("registerCtrl",t);t.$inject=["$location","authentication"];function t(t,e){var r=this;r.credentials={name:"",email:"",password:""};r.returnPage=t.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.name||!r.credentials.email||!r.credentials.password){r.formError={message:"All fields required, please try again"};return false}else{r.formError="";e.register(r.credentials).error(function(t){r.formError.message=t}).then(function(){t.search("page",null);t.path(r.returnPage)})}}}})();(function(){angular.module("adminApp").controller("loginCtrl",t);t.$inject=["$location","authentication"];function t(t,e){var r=this;r.credentials={email:"",password:""};r.returnPage=t.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.email||!r.credentials.password){r.formError={message:"All fields required, please try again"};return false}else{r.doLogin=function(){r.formError="";e.login(r.credentials).error(function(t){r.formError=t}).then(function(){t.search("page",null);t.path(r.returnPage)})};r.doLogin()}}}})();(function(){angular.module("adminApp").directive("navadmin",t);function t(){return{restrict:"EA",templateUrl:"/common/directives/navadmin/navadmin.template.html",controller:"navadminCtrl as navvm"}}})();(function(){angular.module("adminApp").controller("navadminCtrl",t);t.$inject=["$location","authentication"];function t(t,e){var r=this;r.currentPath=t.path();r.isLoggedIn=e.isLoggedIn();r.currentUser=e.currentUser();r.logout=function(){e.logout();t.path("./")}}})();